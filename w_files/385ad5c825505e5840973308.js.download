var $body=$('body');var browser=b();var widget_baseURL='https://beta.iliketh.at';var widget_baseWEB='';var widget_version='stable';var identify='385ad5c825505e5840973308';var no_image='https://beta.iliketh.at/admin_files/img/no-image.svg';var payment_url='https://beta.iliketh.at/overlay/payment';var enable_apple_pay=true;var enable_amazon_pay=false;var publisher_short_name='Arsenal Direct';var messages={"only_letters_numbers":"Name can only contain letters and numbers","only_numbers":"Please type in a correct number","please_choose_size_first":"Please choose size first","sorry_this_product_is_not_available_in_your_area_at_the_moment":"Sorry, this product is not available in your area at the moment.","size":"SIZE","player":"PLAYER","add_delivery_address":"Add delivery address","remove_delivery_address":"Remove delivery address","order_ref":"Order ref"}
var $product_container=$('.ilt.ilt-38.ilt-385ad5c825505e5840973308.ilt-products');var $iframeId='ilt-sticker-385ad5c825505e5840973308';var $sticker_category_container=$('.ilt-385ad5c825505e5840973308.ilt-sticker-category');var load_main_products=1;var ilt_location=getQueryParam('ilt_location',location.href);var l=getLocation(ilt_location);var host=l.hostname;var page_title=getQueryParam('page_title',location.href);if(typeof(ilt_ga)==='undefined')ilt_ga=function(){return false;}
$(window).on('load',function(){$sticker_category_container.removeAttr('style');initIntersectionObserver();window.parent.postMessage({'sticker_overlay_loaded':true},"*");});$(document).keyup(function(e){e.preventDefault();if(e.keyCode==27){var $active=$product_container.find(".ilt_product.ilt_active");if($active.length===0){window.parent.postMessage({'close_sticker_overlay':true},"*");}}});$('.ilt-category-tab').click(function(){$this=$(this);var category_id=$this.attr('id');$('.ilt-category-tab').removeClass('ilt-active');$this.addClass('ilt-active');tap($this);$('.ilt-product-tab-content .ilt-category').removeClass('ilt-active');var product_panel=$('.ilt-product-tab-content').find('#category-'+category_id);product_panel.addClass('ilt-active');if(!('IntersectionObserver'in window)){lazy_load(product_panel);lazyLoadMainProducts(product_panel);}
ilt_ga('send','event',{eventCategory:'ILT Sticker Tab Switched',eventAction:'click',eventLabel:publisher_short_name});});$('.ilt-product-container').click(function(){tap($(this));var product_id=$(this).attr('id');$('.ilt-product-container').removeClass('ilt-active');$(this).addClass('ilt-active');load_product(product_id,true);window.parent.postMessage({'product_open':true},"*");ilt_ga('send','event',{eventCategory:'ILT Sticker Product Opened',eventAction:'click',eventLabel:publisher_short_name});});function initIntersectionObserver()
{if(!('IntersectionObserver'in window)){console.log('IntersectionObserver NOT supported');lazy_load($('.ilt-category.ilt-active'));if(load_main_products){$('.ilt-product-tab-content').find('.ilt-category.ilt-active').addClass('ilt_lazy_loaded');}}else{console.log('IntersectionObserver supported');const config={rootMargin:'50px 0px',threshold:0.01};var observer=new IntersectionObserver(function(entries){$(entries).each(function(){var entry=$(this)[0];if(entry.intersectionRatio>0){observer.unobserve(entry.target);preloadImage($(entry.target));}});},config);$('.ilt-product-panel').find('.ilt-product-image').each(function(){var image=$(this)[0];observer.observe(image);});if(load_main_products){var observer2=new IntersectionObserver(function(entries){$(entries).each(function(){var entry=$(this)[0];if(entry.intersectionRatio>0){observer2.unobserve(entry.target);$(entry.target).find('.ilt-product-container').each(function(){var product_id=$(this).attr('id');load_product(product_id,false,false);});}});},config);$('.ilt-product-tab-content').find('.ilt-product-panel').each(function(){var product_panel=$(this)[0];observer2.observe(product_panel);});}}}
function lazyLoadMainProducts(product_panel)
{if(!load_main_products){return;}
if(product_panel.hasClass('ilt_lazy_loaded')){return;}
product_panel.find('.ilt-product-container').each(function(){var product_id=$(this).attr('id');load_product(product_id,false,false);});product_panel.addClass('ilt_lazy_loaded');}
function lazy_load($where)
{console.log('lazy load');$.each($where.find("img:not(.ilt_lazy_loaded)"),function(){preloadImage($(this));});}
function preloadImage(image)
{var url=image.data("load");if(url){image.attr("src",url);image.removeAttr("data-load");image.one("load",function(){image.addClass("ilt_lazy_loaded");image.parent().fadeOut(1,function(){image.parent().fadeIn();});});image.one("error",function(){image.attr('src',no_image);});}}
window.addEventListener("message",onParentMessage,false);$(window).resize(function(){resize_mobile_gallery();});$(window).on('load',function(){$product_container.removeAttr('style').next('.ilt_overlay_loading').remove();});$product_container.delegate(".ilt-product-category-tabs > .ilt-category-tab","click",function(){var $c_product=$product_container.find(".ilt_product.ilt_active");var product_id=$c_product.attr("data-product");close_overlay();$this=$(this);var product_category_id=$this.attr('id');var category_id=product_category_id.replace(product_id+'_','');$('.ilt-category-tab').removeClass('ilt-active');$this.addClass('ilt-active');$sticker_category_container.find('.ilt-category-tabs #'+category_id+'.ilt-category-tab').addClass('ilt-active');tap($this);$sticker_category_container.find('.ilt-product-tab-content .ilt-category').removeClass('ilt-active');var product_panel=$('.ilt-product-tab-content').find('#category-'+category_id);product_panel.addClass('ilt-active');if(!('IntersectionObserver'in window)){lazy_load(product_panel);lazyLoadMainProducts(product_panel);}
ilt_ga('send','event',{eventCategory:'ILT Sticker Tab Switched',eventAction:'click',eventLabel:publisher_short_name});});$product_container.delegate(".ilt-related-button","click",function(){var $c_product=$product_container.find(".ilt_product.ilt_active");var ilt_checkout_show=$c_product.find('.ilt_main_page .ilt_checkout_show_desktop');var ilt_checkout_hide=$c_product.find('.ilt_main_page .ilt_checkout_hide_desktop');if(ilt_checkout_show.is(':visible')){var related_wrapper=ilt_checkout_show.find('.ilt_related_wrapper');}else if(ilt_checkout_hide.is(':visible')){var related_wrapper=ilt_checkout_hide.find('.ilt_related_wrapper');}
var scroll_top=$body.scrollTop()||$('html').scrollTop();var screen_height=$(window).height();var page_bottom=(scroll_top+screen_height);var related_top=related_wrapper.offset().top;if(!(page_bottom>related_top)){$c_product.find('.ilt_product_wrapper').animate({scrollTop:related_top},1000);}
$(this).hide();});$product_container.delegate(".ilt_main_page .ilt_product_cross","click",function(){close_overlay();});$product_container.delegate(".ilt_product_backdrop","click",function(){close_overlay();});$product_container.delegate(".ilt_related_wrapper .ilt_related_col","click",function(e){e.preventDefault();tap($(this));load_product($(this).attr("data-product"),true);ilt_ga('send','event',{eventCategory:(typeof $sticker_category_container!=='undefined'?'ILT Sticker Product Related Clicked':'ILT Product Related Clicked'),eventAction:'click',eventLabel:publisher_short_name});});$product_container.delegate(".ilt_variations .ilt_variation","click",function(e){e.preventDefault();load_product($(this).attr("data-product"),true);});$product_container.delegate(".ilt_main_page .ilt_checkout_show_desktop .ilt_product_detail","click",function(e){e.preventDefault();e.stopImmediatePropagation();var $c_product=$product_container.find(".ilt_product.ilt_active");var product_id=$c_product.attr("data-product");if(!$c_product.hasClass('details_loaded')){loadProductDetails(product_id);return;}
expandProductDetails();});$product_container.delegate(".ilt_main_page .ilt_checkout_hide_desktop .ilt_product_detail","click",function(){var extra_page=$(this).attr('data-extra-page');var $c_product=$product_container.find(".ilt_product.ilt_active");var product_id=$c_product.attr("data-product");if(!$c_product.hasClass('details_loaded')){loadProductDetails(product_id);}
open_extra_page(extra_page);});$product_container.delegate(".ilt_info_page .ilt_product_back","click",function(){close_extra_page("info");var $c_product=$product_container.find(".ilt_product.ilt_active");var $scrollTo=$c_product.find(".ilt_checkout_hide_desktop .ilt_product_details_wrapper");$c_product.find('.ilt_product_wrapper').scrollTop($scrollTo.position().top);});$product_container.delegate(".ilt_shipping_page .ilt_product_back","click",function(){close_extra_page("shipping");var $c_product=$product_container.find(".ilt_product.ilt_active");var $scrollTo=$c_product.find(".ilt_checkout_hide_desktop .ilt_product_details_wrapper");$c_product.find('.ilt_product_wrapper').scrollTop($scrollTo.position().top);});$product_container.delegate(".ilt_main_page .ilt_product_size_guide","click",function(e){e.preventDefault();var $c_product=$product_container.find(".ilt_product.ilt_active");if($c_product.find(".ilt_extra_page.ilt_size_guide_page .ilt_info_box_content").html().length){open_extra_page("size_guide");}
else{$.ajax({url:widget_baseURL+'/overlay/load-size-guide',type:"POST",data:{"product_id":$c_product.data('product')},beforeSend:function(){$c_product.addClass("ilt_loading");},complete:function(){$c_product.removeClass("ilt_loading");},success:function(result){$c_product.find(".ilt_extra_page.ilt_size_guide_page .ilt_info_box_content").html(result);open_extra_page("size_guide");},error:function(){}});}});$product_container.delegate(".ilt_size_guide_page .ilt_product_back","click",function(){close_extra_page("size_guide");var $c_product=$product_container.find(".ilt_product.ilt_active");var $scrollTo=$c_product.find(".ilt_checkout_hide_desktop .ilt_product_size_guide");$c_product.find('.ilt_product_wrapper').scrollTop($scrollTo.offset().top-$(this).offset().top);});$product_container.delegate(".ilt_main_page .ilt_product_checkout","click",function(){var $this=$(this);var size=$this.parent().parent().find(".ilt_product_size");var size_error=$this.parent().parent().find(".ilt_size_error");var reg_name=new RegExp("[^a-zA-Z0-9 \-]");var reg_number=new RegExp("[^0-9]");if($this.parent().parent().find('.ilt_product_personalisation').val()=='OWN_NAME_NUMBER'&&reg_name.test($this.parent().parent().find('.ilt_own_name_input').val())){size_error.html(messages.only_letters_numbers);}
else if($this.parent().parent().find('.ilt_product_personalisation').val()=='OWN_NAME_NUMBER'&&reg_number.test($this.parent().parent().find('.ilt_own_number_input').val())){size_error.html(messages.only_numbers);}
else if(size.length&&!size.val()){size_error.html(messages.please_choose_size_first);}
else{size_error.html('');var product_id=$this.data('product');getCheckoutPartial(product_id);open_extra_page("checkout");ilt_ga('send','event',{eventCategory:(typeof $sticker_category_container!=='undefined'?'ILT Sticker Product Checkout':'ILT Product Checkout'),eventAction:'click',eventLabel:publisher_short_name});}});$product_container.delegate(".ilt_checkout_page .ilt_product_back","click",function(){returnToArticle();});$product_container.delegate(".ilt_checkout_page .ilt_product_cross","click",function(){returnToArticle();});$product_container.delegate(".ilt_return","click",function(){returnToArticle();});$product_container.delegate("select","focusin",function(){var $this=$(this);$this.parent().addClass("ilt_product_button_select_wrapper_focused");});$product_container.delegate("select","focusout",function(){var $this=$(this);$this.parent().removeClass("ilt_product_button_select_wrapper_focused");});$product_container.delegate("select","change",function(){var $this=$(this);$this.parent().removeClass("ilt_product_button_select_wrapper_focused");});$product_container.delegate(".ilt_product_size","change",function(){var $this=$(this);var $c_product=$product_container.find(".ilt_product.ilt_active");$c_product.find('.ilt_product_size').val($this.val());$this.parent().removeClass("ilt_product_button_select_wrapper_focused");$c_product.find('input[name="Cart[size_id]"]').val($this.val());$c_product.find('.ilt_checkout_product_size').html($this.val()!=''?(messages.size+': '+$this.find('option:selected').text()):'');});$product_container.delegate(".ilt_product_image_wrapper_side","click",function(){var $this=$(this);var $c_product=$product_container.find(".ilt_product.ilt_active");var $img=$this.find("img");var $main_img=$c_product.find(".ilt_checkout_show_desktop .ilt_product_image_wrapper img");if($main_img.attr("src")!=$img.attr("src")){$main_img.removeClass("ilt_lazy_loaded");setTimeout(function(){$main_img.parent().animate({opacity:0},200,function(){$main_img.attr("src",$img.attr("src"));$main_img.one("load",function(){$main_img.parent().animate({opacity:1},200);});});},300);}});$product_container.delegate(".ilt_checkout_form_title_delivery","click",function(){var $this=$(this);var $c_product=$product_container.find(".ilt_product.ilt_active");var $element=$c_product.find(".ilt_checkout_form_delivery");if($element.hasClass("ilt_checkout_form_delivery_active")){updateDeliveryBox(true);$this.html(messages.add_delivery_address);$element.fadeOut(400,function(){$.each($element.find("input"),function(){var $t=$(this);var n=$t.attr("name");var old_name=n.replace("delivery","billing");$t.val($c_product.find("input[name*='"+old_name+"']").val());});$element.removeClass("ilt_checkout_form_delivery_active");});}else{$this.html(messages.remove_delivery_address);$element.find("input").val("");$element.fadeIn(400,function(){$element.addClass("ilt_checkout_form_delivery_active");if(window.innerWidth<990){var scroll_top=$('.ilt_checkout_form_delivery_active').offset().top-$c_product.find('.ilt_delivery_box').offset().top;$c_product.find('.ilt_product_wrapper').animate({scrollTop:scroll_top},1000);}});}});$product_container.delegate(".ilt_checkout_table .ilt_form_radio input[type=radio]","change",function(){var $this=$(this);$.each($product_container.find(".ilt_checkout_table .ilt_form_radio input[type=radio]"),function(){$(this).parents("tr").removeClass("ilt_checkout_table_radio_active");});$this.parents("tr").addClass("ilt_checkout_table_radio_active");checkbox_calculate_price();updateOrderReferenceDetails();});$product_container.delegate(".ilt_product_image_wrapper_dots li a","click",function(){var $this=$(this);var $c_product=$product_container.find(".ilt_product.ilt_active");var $wrapper=$c_product.find(".ilt_checkout_hide_desktop .ilt_product_image_wrapper");var index=$this.attr("data-img");$c_product.find(".ilt_product_image_wrapper_dots li.ilt_active").removeClass("ilt_active");$this.parent().addClass("ilt_active");var $active_img=$wrapper.find(".ilt_product_image_wrapper_single[data-img="+index+"]");var from_left=$active_img.offset().left;var posX=0;if($wrapper.css('-webkit-transform')!="none"){var currTrans=$wrapper.css('-webkit-transform').split(/[()]/)[1];posX=parseInt(currTrans.split(',')[4]);}
$wrapper.attr("data-img",index);$wrapper.css('-webkit-transform','translateX('+-(Math.abs(posX)+from_left)+'px)');});var startx=0;var touchobj=null;var touch_timer=0;$product_container.on("touchstart",function(e){var $c_product=$product_container.find(".ilt_product.ilt_active");if(!$c_product)return;touchobj=e.changedTouches[0];startx=parseInt(touchobj.clientX);});$product_container.on("touchmove",function(e){e.stopImmediatePropagation();if(!startx)return;touchobj=e.changedTouches[0];var dist=parseInt(touchobj.clientX)-startx;var $c_product=$product_container.find(".ilt_product.ilt_active");if(!$c_product)return;var $wrapper=$c_product.find(".ilt_checkout_hide_desktop .ilt_product_image_wrapper");var g_index=$wrapper.attr("data-img");if(typeof g_index==='undefined'){return;}
var last_index=$wrapper.find(".ilt_product_image_wrapper_single:last").attr("data-img");if(dist<-30){if(g_index<last_index){g_index++;}}
else if(dist>30){if(g_index>0){g_index--;}}
if((dist<-30||dist>30)&&!touch_timer){var $active_img=$wrapper.find(".ilt_product_image_wrapper_single[data-img="+g_index+"]");if($active_img.length<=0){return;}
var from_left=$active_img.offset().left;var posX=0;if($wrapper.css('-webkit-transform')!="none"){var currTrans=$wrapper.css('-webkit-transform').split(/[()]/)[1];posX=parseInt(currTrans.split(',')[4]);}
$wrapper.attr("data-img",g_index);$wrapper.css('-webkit-transform','translateX('+-(Math.abs(posX)+from_left)+'px)');$c_product.find(".ilt_product_image_wrapper_dots li.ilt_active").removeClass("ilt_active");$c_product.find(".ilt_product_image_wrapper_dots li a[data-img="+g_index+"]").parent().addClass("ilt_active");touch_timer=setTimeout(function(){clearInterval(touch_timer);touch_timer=0;startx=0;},300);}});$product_container.delegate(".ilt_checkout_country","change",function(){updateDeliveryBox();});$product_container.delegate(".ilt_checkout_postalcode","change",function(){updateDeliveryBox();});$product_container.delegate(".ilt_own_name_input","keypress",function(e){var regex=new RegExp("^[a-zA-Z0-9\\-\\s]+$");var str=String.fromCharCode(!e.charCode?e.which:e.charCode);if(e.keyCode==8||e.keyCode==46||regex.test(str)){return true;}
e.preventDefault();return false;});$product_container.delegate(".ilt_own_name_input","keyup",function(){var $c_product=$product_container.find(".ilt_product.ilt_active");$c_product.find('.ilt_own_name_input').val($(this).val());$c_product.find('input[name="Cart[own_name]"]').val($(this).val());});$product_container.delegate(".ilt_own_number_input","keyup",function(){var $c_product=$product_container.find(".ilt_product.ilt_active");$c_product.find('.ilt_own_number_input').val($(this).val());$c_product.find('input[name="Cart[own_number]"]').val($(this).val());});$product_container.delegate(".ilt_product_personalisation","change",function(){var $c_product=$product_container.find(".ilt_product.ilt_active");$c_product.find('.ilt_product_personalisation').val($(this).val());PersonalisationUpdate();setPatchesImage();});$product_container.delegate(".ilt_product_patches","change",function(){var $c_product=$product_container.find(".ilt_product.ilt_active");$c_product.find('.ilt_product_patches').val($(this).val());PersonalisationUpdate();setPatchesImage();});function getPersonalisationImageUrl()
{var $c_product=$product_container.find(".ilt_product.ilt_active");var $image_wrapper=$c_product.find(".ilt_checkout_show_desktop .ilt_product_image_wrapper");if($image_wrapper.attr('data-personalisation')==='true'){return $image_wrapper.children('img').attr('src');}
var $default_img=$c_product.find(".ilt_checkout_show_desktop .ilt_product_image_wrapper_side:first img").attr('src');var lastslashindex=$default_img.lastIndexOf('/');var ID=$default_img.substring(lastslashindex+1).replace("_f","").toUpperCase();var player_image=$c_product.find('.ilt_product_personalisation').find(':selected').attr('data-image');var product_name=$c_product.find('.ilt_product_details .ilt_product_title_desktop').html();if(product_name.toLowerCase().includes("training")){player_image=trainingImageUrl(player_image);}
if(player_image){return player_image;}
if(product_name.toLowerCase().includes("away")&&product_name.toLowerCase().includes("20/21")){return 'https://x1.adis.ws/v1/media/graphics/i/ArsenalDirect/'+ID+'_pl?patches=patchesnone&name=&numbers=pl-away__2020-21--1&h=814';}
if(product_name.toLowerCase().includes("third")&&product_name.toLowerCase().includes("20/21")){return 'https://x1.adis.ws/v1/media/graphics/i/ArsenalDirect/'+ID+'_pl?patches=patchesnone&name=&numbers=pl-third__2020-21--1&h=814';}
return 'https://x1.adis.ws/v1/media/graphics/i/ArsenalDirect/'+ID+'_wsl?patches=patchesnone&name=&numbers=wsl-home__2020-21--1&h=814';}
$product_container.delegate(".ilt_own_name_number input","change",function(){ownPlayerName();setPatchesImage();});$product_container.delegate(".ilt_checkout_scroll_email","click",function(e){e.preventDefault();e.stopImmediatePropagation();var $c_product=$product_container.find(".ilt_product.ilt_active");$c_product.find('.ilt_product_wrapper').animate({scrollTop:$c_product.find('.ilt_delivery_box').height()+200},300);$c_product.find("input[name=\'Cart[email]\']").focus();});$product_container.delegate(".ilt_checkout_show_cart","click",function(e){e.preventDefault();e.stopImmediatePropagation();sendCheckout();});$product_container.delegate(".ilt_apple_pay_confirm_btn","click",function(e){e.preventDefault();sendCheckout();});$product_container.delegate(".ilt_checkout_form input[name*='Cart[billing_']","change",function(e){var $c_product=$product_container.find(".ilt_product.ilt_active");if(!$c_product.find(".ilt_checkout_form_delivery").hasClass('ilt_checkout_form_delivery_active')){var $this=$(this);var name=$this.attr("name");var new_name=name.replace("billing","delivery");$c_product.find(".ilt_checkout_form").find("input[name*='"+new_name+"']").val($this.val());}});$product_container.delegate(".ilt_checkout_form","submit",function(e){e.preventDefault();e.stopImmediatePropagation();sendCheckout();return false;});$product_container.delegate(".ilt_product_previous_product","click",function(e){e.preventDefault();e.stopImmediatePropagation();var $active=$product_container.find(".ilt_product.ilt_active");var $prev=$active.prev(".ilt_product");if(!$prev.length)
$prev=$active.parent().find(".ilt_product").last();var $content=$.trim($prev.html());if(!$content.length){load_product($prev.attr("data-product"));}else{$active.css({'display':''}).removeClass("ilt_active");$prev.addClass("ilt_active");}
var product_id=$prev.attr("data-product");init_product(product_id,$product_container.find(".ilt_product.ilt_active"))});$product_container.delegate(".ilt_product_next_product","click",function(e){e.preventDefault();var $active=$product_container.find(".ilt_product.ilt_active");var $next=$active.next(".ilt_product");if(!$next.length)
$next=$active.parent().find(".ilt_product").first();var $content=$.trim($next.html());if(!$content.length){load_product($next.attr("data-product"));}else{$active.css({'display':''}).removeClass("ilt_active");$next.addClass("ilt_active");}
var product_id=$next.attr("data-product");init_product(product_id,$product_container.find(".ilt_product.ilt_active"))});$(document).keyup(function(e){e.preventDefault();if(e.keyCode==27){overlayBack();}});var related_ids=[];function initOverlay(product_id)
{$product_container.find(".ilt_product[data-product="+product_id+"]:first").css('display','block').addClass("ilt_active");lazy_load($product_container.find(".ilt_product.ilt_active .ilt_main_page"));if($product_container.find('.selectric-ilt_product_button_select').length){$('.ilt_product_button_select_wrapper').addClass('ilt_product_button_select_wrapper_selectric');}
disactiveElements();}
function initRelatedButton(product_id)
{}
function loadProductDetails(product_id)
{var $c_product=$product_container.find(".ilt_product.ilt_active");var $details_wrapper_desktop=$c_product.find('.ilt_checkout_show_desktop .ilt_product_details_wrapper');var $details_wrapper_mobile=$c_product.find('.ilt_checkout_hide_desktop .ilt_product_details_wrapper');setTimeout(function(){$details_wrapper_desktop.show();$details_wrapper_mobile.show();},800);if($c_product.hasClass('details_loaded')){return;}
var $ilt_info_box_content=$c_product.find('.ilt_checkout_show_desktop .ilt_product_details_wrapper .ilt_info_box_content');var $extra_page_info=$c_product.find('.ilt_extra_page.ilt_info_page .ilt_info_box_content');var $extra_page_shipping=$c_product.find('.ilt_extra_page.ilt_shipping_page .ilt_info_box_content');$.ajax({url:widget_baseURL+'/overlay/load-product-details',type:"GET",data:{"product_id":product_id},success:function(result){if(result.description){$ilt_info_box_content.html(result.description);}
if(result.description){$extra_page_info.html(result.description);}
if(result.shipping_and_returns){$extra_page_shipping.html(result.shipping_and_returns);}
$c_product.addClass('details_loaded');expandProductDetails();},error:function(){}});}
function expandProductDetails()
{var $c_product=$product_container.find(".ilt_product.ilt_active");var $ilt_product_detail=$c_product.find('.ilt_main_page .ilt_checkout_show_desktop .ilt_product_detail');if(!$ilt_product_detail.hasClass("ilt_active")){$product_container.find(".ilt_main_page .ilt_checkout_show_desktop .ilt_product_detail.ilt_active .ilt_product_detail_content").animate({height:0,padding:0},1000);$product_container.find(".ilt_main_page .ilt_checkout_show_desktop .ilt_product_detail.ilt_active").removeClass("ilt_active");var el=$ilt_product_detail.find(".ilt_product_detail_content"),curHeight=el.height(),autoHeight=el.css('height','auto').height();el.height(curHeight).animate({height:autoHeight},1000);$ilt_product_detail.addClass("ilt_active");}else{$ilt_product_detail.find(".ilt_product_detail_content").animate({height:0},1000);$ilt_product_detail.removeClass("ilt_active");}}
function close_overlay(return_to_article)
{var $c_product=$product_container.find(".ilt_product.ilt_active");if(typeof $sticker_category_container!=='undefined'){$c_product.removeClass('ilt_active');$c_product.removeAttr('style');$sticker_category_container.find('.ilt-product-container').removeClass('ilt-active');if(return_to_article){window.parent.postMessage({'close_sticker_overlay':true},"*");}}
disactiveElements();window.parent.postMessage({'product_close':true,'iframeId':$iframeId},"*");}
function disactiveElements()
{var $c_product=$product_container.find(".ilt_product.ilt_active");var $details_wrapper_desktop=$c_product.find('.ilt_checkout_show_desktop .ilt_product_details_wrapper');var $details_wrapper_mobile=$c_product.find('.ilt_checkout_hide_desktop .ilt_product_details_wrapper');var $related_wrapper=$c_product.find('.ilt_related_wrapper');$details_wrapper_desktop.hide();$details_wrapper_mobile.hide();$related_wrapper.hide();}
function load_product(product_id,show,init)
{if(!product_id){return;}
var $maybe_exist=$product_container.find(".ilt_product[data-product="+product_id+"]:first");var $content=$.trim($maybe_exist.html());var is_sticker=typeof $sticker_category_container!=='undefined';if((typeof init==='undefined'||init)&&$maybe_exist.length&&$content.length){$product_container.find(".ilt_product.ilt_active").removeClass("ilt_active").removeAttr('style');if(is_sticker&&(typeof show==='undefined'||!show)){if(window.innerWidth>991){$maybe_exist.animate({'right':'0%'}).show().focus();}else{$maybe_exist.animate({'bottom':'0%'}).show().focus();}}
$maybe_exist.addClass('ilt_active');init_product(product_id,$maybe_exist);initRelatedButton(product_id);}else{var url=widget_baseURL+'/overlay/load-product';if(typeof vttp!=='undefined'){url+='?vttp='+vttp;}
$.ajax({url:url,type:"POST",data:{"product_id":product_id,"identify":identify},before:function(){$product_container.find(".ilt_product.ilt_active").addClass("ilt_loading");},success:function(result){$product=$(result);if($maybe_exist.length&&!$content.length){$maybe_exist.parent('.ilt_variation').replaceWith($product);}else{var variation_wrapper=$('<div class="ilt_variation"></div>');variation_wrapper.append($product);$product_container.append(variation_wrapper);}
var $c_product=$product_container.find(".ilt_product[data-product="+product_id+"]:first");if(!init){lazy_load($c_product.find(".ilt_product_main_image"));lazy_load($c_product.find(".ilt_product_image_wrapper_single:first"));}
if(typeof init==='undefined'||init){$product_container.find(".ilt_product.ilt_active").removeClass("ilt_active").removeClass("ilt_loading").removeAttr('style');if(is_sticker&&(typeof show==='undefined'||!show)){if(window.innerWidth>991){$c_product.animate({'right':'0%'}).show().focus();}else{$c_product.animate({'bottom':'0%'}).show().focus();}}
$c_product.addClass('ilt_active');init_product(product_id,$product_container.find(".ilt_product.ilt_active"));initRelatedButton(product_id);}},error:function(){}});}}
function init_product(product_id,$c_product)
{if(typeof $c_product==='object'){lazy_load($c_product);}
var sticker_overlay_header=$sticker_category_container.find('.ilt-overlay-header');var sticker_category_tabs=sticker_overlay_header.next('.ilt-category-tabs');if(!$c_product.hasClass('sticker-category-header-loaded')){$c_product.find('.ilt_product_header').html(sticker_overlay_header.html());$c_product.find('.ilt-product-category-tabs').html(sticker_category_tabs.html());var sticker_prodct_category_tabs=$c_product.find('.ilt-product-category-tabs > .ilt-category-tab');sticker_prodct_category_tabs.each(function(){var id=product_id+'_'+$(this).attr('id');$(this).attr('id',id);});$c_product.addClass('sticker-category-header-loaded');}else{var active_tab=sticker_category_tabs.find('.ilt-category-tab.ilt-active');var active_tab_id=active_tab.attr('id');$c_product.find('.ilt-product-category-tabs > #'+product_id+'_'+active_tab_id).addClass('ilt-active');}
setupActiveProduct();scrollTopModal();getRelatedPartial(product_id);getVariationsPartial(product_id);}
function overlayBack()
{$product_container.find('.ilt-shopping-cart-count').text('0');var $active=$product_container.find(".ilt_product.ilt_active");if($active.hasClass("ilt_info_open")){close_extra_page("info");}
else if($active.hasClass("ilt_checkout_open")){close_extra_page("checkout");$active.find('.ilt_load_checkout').removeClass("ilt_checkout_loaded");$active.find('.ilt_payment_iframe iframe').remove();}
else if($active.hasClass("ilt_size_guide_open")){close_extra_page("size_guide");}
else{close_overlay();}}
function returnToArticle()
{var $active=$product_container.find(".ilt_product.ilt_active");close_extra_page("checkout");$active.removeClass("ilt_loading");$active.find('.ilt_load_checkout').removeClass("ilt_checkout_loaded");$active.find('.ilt_payment_iframe iframe').remove();if($active.find('.ilt_load_checkout').hasClass('ilt_checkout_finished')){scrollTopModal();close_overlay(true);}}
function checkbox_calculate_price(){var $c_product=$product_container.find(".ilt_product.ilt_active");var $subtotal=$c_product.find(".ilt_checkout_table .ilt_checkout_subtotal_price");var subtotal_price=parseFloat($subtotal.attr("data-price"));var $delivery=$c_product.find(".ilt_checkout_table .ilt_checkout_table_radio_active");var delivery_price=parseFloat($delivery.attr("data-price"));var $total=$c_product.find(".ilt_checkout_table .ilt_checkout_total_price");var currency=$total.attr("data-currency");var price=(delivery_price+subtotal_price).toFixed(2);var total=currency+price;$c_product.find(".ilt_checkout_table .ilt_checkout_total_price").html(total).attr("data-price",price);}
function lazy_load($where){$.each($where.find("img:not(.ilt_lazy_loaded)"),function(){var $this=$(this);var url=$this.data("load");if(url){$this.attr("src",url);$this.removeAttr("data-load");$this.one("load",function(){$this.addClass("ilt_lazy_loaded");$this.parent().fadeOut(1,function(){$this.parent().fadeIn();});});$this.one("error",function(){$this.attr('src',no_image);});}});loaded_images();}
function loaded_images()
{resize_mobile_gallery();}
function resize_mobile_gallery()
{var $c_product=$product_container.find(".ilt_product.ilt_active");var width=0;var count_images=$c_product.find(".ilt_product_image_wrapper_single").length;$.each($c_product.find(".ilt_product_image_wrapper_single"),function(){width+=$(this).width();});if(width<=0){if(count_images>0){width=count_images*screen.width;}else{width=5000;}}
$c_product.find(".ilt_checkout_hide_desktop .ilt_product_image_wrapper").css({width:width});}
function open_extra_page(where)
{var $c_product=$product_container.find(".ilt_product.ilt_active");var $extra_page_class='ilt_'+where+'_open';if(!$c_product.hasClass($extra_page_class)){$c_product.addClass($extra_page_class);$c_product.find(".ilt_extra_page.ilt_"+where+"_page").css({height:'auto',left:'0'});$c_product.find(".ilt_main_page").css({height:'100vh'});lazy_load($c_product.find(".ilt_extra_page.ilt_"+where+"_page"));}
scrollTopModal();}
function close_extra_page(where)
{var $c_product=$product_container.find(".ilt_product.ilt_active");var $extra_page_class='ilt_'+where+'_open';if($c_product.hasClass($extra_page_class)){$c_product.find(".ilt_extra_page.ilt_"+where+"_page").css({left:''});setTimeout(function(){$c_product.find(".ilt_extra_page.ilt_"+where+"_page").css({height:'0'});},300);$c_product.removeClass($extra_page_class);$c_product.find(".ilt_main_page").css({height:'auto'});}}
function scrollTopModal()
{var $c_product=$product_container.find(".ilt_product.ilt_active");$c_product.find('.ilt_product_wrapper').scrollTop(0);}
function updateDeliveryBox(force_sync)
{var $c_product=$product_container.find(".ilt_product.ilt_active");var product_id=$c_product.data('product');var $is_shipping_different=$c_product.find('.ilt_checkout_form_delivery').hasClass('ilt_checkout_form_delivery_active');var $bill=$c_product.find('.ilt_checkout_country_billing');var $deli=$c_product.find('.ilt_checkout_country_delivery');var $postcode=$c_product.find('.ilt_checkout_postalcode').val();if(!$is_shipping_different||force_sync){$deli.val($bill.val());}
var $billing_country_id=$bill.val();var $delivery_country_id=$deli.val();var personalisation=$c_product.find('input[name="Cart[personalisation]"]').val();if(personalisation=='OWN_NAME_NUMBER'){var $own_name=$c_product.find(".ilt_own_name_input").val();var $own_number=$c_product.find(".ilt_own_number_input").val();}
else{var $own_name=null;var $own_number=null;}
var $patches=null;if(personalisation!=''){$patches=$c_product.find('.ilt_product_patches').val();}
var access_token=null;if(enable_amazon_pay&&typeof amazon_pay.access_token!=='undefined'){access_token=amazon_pay.access_token;$billing_country_id=$delivery_country_id=null;amazonReferenceUpdated=false;}
$.ajax({url:widget_baseURL+'/overlay/load-delivery',type:"POST",data:{accessToken:access_token,"product_id":product_id,"personalisation":personalisation,"billing_country_id":$billing_country_id,"delivery_country_id":$delivery_country_id,"postcode":$postcode,"own_name":$own_name,"own_number":$own_number,"patches":$patches,},beforeSend:function(){$c_product.addClass("ilt_loading");},complete:function(){$c_product.removeClass("ilt_loading");var scroll_top=$c_product.find('.ilt_checkout_product_image_wrapper').height()+100;if(window.innerWidth>=1000){scroll_top=100;}
$c_product.find('.ilt_product_wrapper').animate({scrollTop:scroll_top},1000);},success:function(result){if(result===0){result='<tr><td colspan="3">'+messages.sorry_this_product_is_not_available_in_your_area_at_the_moment+'</td></tr>';$c_product.find('.ilt_checkout_submit_button').addClass('ilt-disabled');}
result=JSON.parse(result);$c_product.find('.ilt_checkout_submit_button').removeClass('ilt-disabled');if(enable_amazon_pay&&typeof amazon_pay.access_token!=='undefined'){if(result.amazon_reference_updated){amazonReferenceUpdated=true;}else{$c_product.find('.ilt_checkout_submit_button').addClass('ilt-disabled');}}
$c_product.find(".ilt_product_price").attr('data-amount',result.product_price);$c_product.find(".ilt_product_price").html(result.product_price_formatted);$c_product.find('.ilt_checkout_product_price').attr('data-price',result.product_price);$c_product.find('.ilt_checkout_product_price').html(result.product_price_formatted);$c_product.find('.ilt_checkout_table_delivery').html(result.html);},error:function(){}});}
function onCheckoutMessage(event)
{if(event.origin!==widget_baseURL)return;var prod_id=typeof(event.data.product_id)!='undefined'?event.data.product_id:null;if(prod_id){var $c_product=$product_container.find(".ilt_product.ilt_active");if($c_product.data('product')!=prod_id)return;if(event.data.height){$c_product.find('iframe').css('height',event.data.height+230);}
else if(event.data.error===false){thankYouMessage(event)}
else{$c_product.find('.ilt_checkout_product_row > div:not(.ilt_load_checkout)').hide();var error_msg=typeof(event.data.error)!='undefined'?event.data.error:'Cart session has expired. Please try again.'
$c_product.find('.ilt_load_checkout').html('<div style="color:red;text-align:center;padding:100px 0">'+error_msg+'</div>');$c_product.find('.ilt_load_checkout').removeClass("ilt_checkout_loaded");$c_product.find('.ilt_payment_iframe iframe').remove();console.log('Error: '+event.data.error)}}}
function thankYouMessage(event){var $c_product=$product_container.find(".ilt_product.ilt_active");if($c_product.hasClass("ilt_checkout_open")){$product_container.find(".ilt_checkout_page .ilt_product_back").addClass('ilt_product_cross ilt_product_left_cross').removeClass('ilt_product_back');$c_product.find('.ilt_checkout_product_row > div:not(.ilt_load_checkout)').hide();$c_product.find('.ilt_load_checkout').html(event.data.thank_you_message);if($c_product.find('.ilt_product_size').length)$c_product.find('.ilt_product_size').val('');$c_product.find('.ilt_load_checkout').removeClass("ilt_checkout_loaded").addClass('ilt_checkout_finished');$c_product.find('.ilt_payment_iframe iframe').remove();ilt_ga('send','event',{eventCategory:(typeof $sticker_category_container!=='undefined'?'ILT Sticker Product Purchased':'ILT Product Purchased'),eventAction:'click',eventLabel:publisher_short_name});}}
function sendCheckout()
{var $c_product=$product_container.find(".ilt_product.ilt_active");var $form=$c_product.find(".ilt_checkout_form");var serialize=$form.serialize();var is_apple_pay=$c_product.find('input[name="Cart[apple_pay]"]').val()!=0;var is_amazon_pay=false;$c_product.find('.ilt_checkout_submit_button').addClass('ilt-disabled');if(!$c_product.find('.ilt_checkout_enter_card').is(':hidden')){$c_product.find('.ilt_checkout_submit_button_pay').text('Please wait...');}
if(enable_amazon_pay&&typeof amazon_pay.access_token!=='undefined'){if(!amazonReferenceUpdated){scrollTopModal();return false;}
is_amazon_pay=true;serialize+='&accessToken='+amazon_pay.access_token;}
serialize+='&url='+encodeURIComponent(ilt_location);$.ajax({url:widget_baseURL+'/shop/checkout',type:"POST",dataType:"json",data:serialize,beforeSend:function(){if(is_amazon_pay){$c_product.addClass("ilt_loading");}
$c_product.find(".ilt_checkout_form_group_has_error").removeClass("ilt_checkout_form_group_has_error");$c_product.find(".ilt_checkout_form_help_block").html("");},complete:function(){$c_product.removeClass("ilt_loading");},success:function(result){$c_product.find('.ilt_apple_pay_confirm_info, .ilt_apple_pay_confirm_btn').hide();if(result.success){if(result.is_apple_pay===1||result.is_amazon_pay===1){var payment_response=result.payment_response;if(payment_response.data.success){thankYouMessage(result.payment_response);}else{if(payment_response.data.soft_error){$c_product.find('.payment-errors').html(payment_response.data.error);}else{$c_product.find('.ilt_load_checkout').html('<div class="payment-errors">'+payment_response.data.error+'</div>');}}
if(result.token){$form.find('input[name="Cart[token]"]').remove();$form.append('<input type="hidden" name="Cart[token]" value="'+result.token+'">');}}
else{$c_product.find('.ilt_hide_apple_pay').show();$c_product.find('.ilt_hide_apple_pay_later').show();if($c_product.hasClass("ilt_checkout_open")){$c_product.find(".ilt_checkout_enter_card").show();$c_product.find('.ilt_product_wrapper').scrollTop(99999);$c_product.find(".ilt_checkout_show_cart").hide();$c_product.find('.ilt_product_wrapper').animate({scrollTop:$(".ilt_payment_iframe").position().top},1000);}
$c_product.find('.ilt_checkout_submit_button').removeClass('ilt-disabled');if(result.token){$form.find('input[name="Cart[token]"]').remove();$form.find('.ilt_checkout_form_title_delivery').remove();$form.append('<input type="hidden" name="Cart[token]" value="'+result.token+'">');$form.submit(function(e){e.preventDefault();return false;});$form.find('select, input[name="Cart[cc]"]').attr('disabled','disabled');$form.find('input').keydown(function(e){e.preventDefault()}).focus(function(){this.blur()});addViewCount(6,$c_product.attr("data-product"),ilt_location,page_title);$form.find('.ilt_payment_iframe').html('<iframe src="'+payment_url+'/'+result.token+'" scrolling="no"></iframe>');if(window.addEventListener)
window.addEventListener("message",onCheckoutMessage,false);else if(window.attachEvent)
window.attachEvent("onmessage",onCheckoutMessage,false);}}}
else if(!result.success||typeof(result.errors)!='undefined'){$c_product.find('.ilt_hide_apple_pay').show();$c_product.find('.ilt_hide_apple_pay_later').show();$c_product.find('.ilt_checkout_submit_button').removeClass('ilt-disabled');$c_product.find('.ilt_checkout_submit_button_pay').text('PAY NOW');if(typeof(result.errors.serious_error)!='undefined'){$c_product.find('.ilt_checkout_product_row > div:not(.ilt_load_checkout)').hide();$c_product.find('.ilt_load_checkout').html('<div class="ilt_load_checkout_errors">'
+result.errors.serious_error+'</div>');$c_product.find('.ilt_load_checkout').removeClass("ilt_checkout_loaded");}
else{var $first=null;$.each(result.errors,function(i,v){var $input=$c_product.find("input[name=\'Cart["+i+"]\'], select[name=\'Cart["+i+"]\']");var $form_group=$input.parents(".ilt_checkout_form_group");$form_group.addClass("ilt_checkout_form_group_has_error");$form_group.find(".ilt_checkout_form_help_block").html(v[0]);if($first==null){$first=$form_group;}});if($first!=null){var scroll_to=$first.offset().top-$c_product.find('.ilt_delivery_box').offset().top-20;$c_product.find('.ilt_product_wrapper').scrollTop(scroll_to);}}}},error:function(){}});}
function setupActiveProduct()
{activateProductNav();}
function activateProductNav()
{var $active=$product_container.find(".ilt_product.ilt_active");var $next=$active.next(".ilt_product");var $prev=$active.prev(".ilt_product");if($next.length||$prev.length){$active.find(".ilt_product_next_product").show();$active.find(".ilt_product_previous_product").show();}}
function getRelatedPartial(product_id)
{var $c_product=$product_container.find(".ilt_product.ilt_active");var $related_wrapper=$c_product.find('.ilt_related_wrapper');setTimeout(function(){$related_wrapper.show();},800);if($c_product.hasClass('related_loaded'))return;var ilt_product_price=$c_product.find(".ilt_product_price");var currency=ilt_product_price.attr('data-currency');var data={"product_id":product_id,"currency":currency};if(typeof $sticker_category_container!=='undefined'){var subcategory=$sticker_category_container.find('.ilt-category .ilt-product-container.ilt-active');var sticker_category_id=subcategory.attr('data-subcategory-id');if(typeof sticker_category_id!=='undefined'){console.log('Number(sticker_category_id)',Number(sticker_category_id))
data.sticker_category_id=Number(sticker_category_id);}}
$.ajax({url:widget_baseURL+'/overlay/load-related',type:"GET",data:data,success:function(result){$related_wrapper.html(result);$c_product.addClass('related_loaded');lazy_load($related_wrapper);}});}
function getVariationsPartial(product_id)
{var $c_product=$product_container.find(".ilt_product.ilt_active");if($c_product.hasClass('variations_loaded'))return;var ilt_product_price=$c_product.find(".ilt_product_price");$.ajax({url:widget_baseURL+'/overlay/load-variations',type:"GET",data:{"product_id":product_id},success:function(result){if(result==''){return;}
$c_product.find('.ilt_variations').html(result);$.each($c_product.find('.ilt_variations > div > .ilt_variation'),function(){var $this=$(this);variation_id=$this.attr("data-product");if($c_product.parent('.ilt_variation').children(".ilt_product[data-product="+variation_id+"]").length==0){$c_product.parent('.ilt_variation').append('<div class="ilt_product" data-product="'+variation_id+'"></div>');}});activateProductNav();$c_product.addClass('variations_loaded');lazy_load($c_product.find('.ilt_variations'));}});}
function onParentMessage(event)
{if(typeof event.data!=='object'){return;}
var $c_product=$product_container.find(".ilt_product.ilt_active");if(event.data.sticker_back){overlayBack();}else if(event.data.load_image_product){var product_id=event.data.product_id;load_product(product_id);}else if(event.data.apple_pay_init){console.log('apple_pay_init 3');var result=event.data.result;$c_product.find('.ilt_apple_pay_btn').removeClass('ilt_apple_pay_not_init').click(function(e){$c_product.find('.ilt_hide_apple_pay').hide();$c_product.find('.ilt_apple_pay_btn').hide();var amount=$c_product.find(".ilt_checkout_table .ilt_checkout_total_price").attr("data-price");var currency=$c_product.find(".ilt_checkout_table .ilt_checkout_total_price").attr("data-currency-iso");console.log('apple_pay_init 4');var paymentRequest={countryCode:result.apple_pay.countryCode,currencyCode:currency,total:{label:result.apple_pay.label,amount:amount},requiredBillingContactFields:['postalAddress'],requiredShippingContactFields:['postalAddress','phone','email','name']};window.parent.postMessage({'apple_pay_request':true,'iframeId':$iframeId,'paymentRequest':paymentRequest},"*");});}else if(event.data.apple_pay_response){console.log('apple_pay_response 1');if(event.data.success&&typeof event.data.res==='object'){applePaySuccess(event.data.res);}else{if(event.data.cancel){$c_product.find('.ilt_hide_apple_pay').show();$c_product.find('.ilt_apple_pay_btn').show();$('.ilt_apple_pay_confirm_info, .ilt_apple_pay_confirm_btn').hide();return;}
$c_product.find('.ilt_apple_pay_btn').show();$c_product.find('.ilt_hide_apple_pay').show();$('.ilt_apple_pay_confirm_info, .ilt_apple_pay_confirm_btn').hide();}}}
function applePaySuccess(res)
{var $c_product=$product_container.find(".ilt_product.ilt_active");var billing_ori_country=$c_product.find("select[name='Cart[billing_country]']").val();var delivery_ori_country=$c_product.find("select[name='Cart[delivery_country]']").val();var $element=$c_product.find(".ilt_checkout_form_delivery");if(!$element.hasClass("ilt_checkout_form_delivery_active")){$c_product.find('.ilt_checkout_form_title_delivery').html("Remove delivery address");$element.fadeIn().addClass("ilt_checkout_form_delivery_active");}
$c_product.find("input[name='Cart[apple_pay]']").val(res.token.id);$c_product.find("input[name='Cart[email]']").val(res.shippingContact.emailAddress);$c_product.find("input[name='Cart[cc]']").prop('checked',true);var full_name=res.token.card.name.split(' ');var billing_country_changed=false;var delivery_country_changed=false;$c_product.find("input[name='Cart[billing_firstname]']").val(full_name[0]);$c_product.find("input[name='Cart[billing_lastname]']").val(full_name[full_name.length-1]);$c_product.find("input[name='Cart[billing_address_1]']").val(res.token.card.address_line1);$c_product.find("input[name='Cart[billing_address_2]']").val(res.token.card.address_line2);$c_product.find("input[name='Cart[billing_city]']").val(res.token.card.address_city);$c_product.find("input[name='Cart[billing_postcode]']").val(res.token.card.address_zip);$c_product.find("input[name='Cart[billing_telephone]']").val(res.shippingContact.phoneNumber);var country_billing_id=$c_product.find("select[name='Cart[billing_country]'] option[data-iso='"
+res.token.card.address_country.toUpperCase()+"']").val();if(country_billing_id){if(country_billing_id!=billing_ori_country){billing_country_changed=true;}
$c_product.find("select[name='Cart[billing_country]']").val(country_billing_id);}
$c_product.find("input[name='Cart[delivery_firstname]']").val(res.shippingContact.givenName);$c_product.find("input[name='Cart[delivery_lastname]']").val(res.shippingContact.familyName);$c_product.find("input[name='Cart[delivery_address_1]']").val(res.shippingContact.addressLines[0]);$c_product.find("input[name='Cart[delivery_address_2]']").val(res.shippingContact.addressLines[1]);$c_product.find("input[name='Cart[delivery_city]']").val(res.shippingContact.locality);$c_product.find("input[name='Cart[delivery_postcode]']").val(res.shippingContact.postalCode);$c_product.find("input[name='Cart[delivery_telephone]']").val(res.shippingContact.phoneNumber);var country_delivery_id=$c_product.find("select[name='Cart[delivery_country]'] option[data-name='"
+res.shippingContact.country+"']").val();if(country_delivery_id){if(country_delivery_id!=delivery_ori_country){delivery_country_changed=true;}
$c_product.find("select[name='Cart[delivery_country]']").val(country_delivery_id);}
updateDeliveryBox();if(country_billing_id&&country_delivery_id&&!billing_country_changed&&!delivery_country_changed&&$c_product.find('.ilt_checkout_total_price').length)
{sendCheckout();}
else{if(!country_billing_id||!country_delivery_id){$c_product.find('.ilt_hide_apple_pay').show();$c_product.find('.ilt_hide_apple_pay_later').show();$c_product.find('.ilt_product_wrapper').animate({scrollTop:0},300);}
else{$c_product.find('.ilt_apple_pay_confirm_info, .ilt_apple_pay_confirm_btn').show();$c_product.find('.ilt_hide_apple_pay_later').hide();}}}
function getCheckoutPartial(product_id)
{var $c_product=$product_container.find(".ilt_product.ilt_active");$c_product.find('.ilt_load_checkout').removeClass('ilt_checkout_finished');if($c_product.find('.ilt_load_checkout').hasClass('ilt_checkout_loaded'))return;var $is_shipping_different=$c_product.find('.ilt_checkout_form_delivery').hasClass('ilt_checkout_form_delivery_active');var $bill=$c_product.find('.ilt_checkout_country_billing');var $deli=$c_product.find('.ilt_checkout_country_delivery');if(!$is_shipping_different){$deli.val($bill.val());}
var personalisation=$c_product.find('input[name="Cart[personalisation]"]').val();if(personalisation=='OWN_NAME_NUMBER'){var $own_name=$c_product.find(".ilt_own_name_input").val();var $own_number=$c_product.find(".ilt_own_number_input").val();}
else{var $own_name=null;var $own_number=null;}
var $patches=null;if(personalisation!=''){$patches=$c_product.find('.ilt_product_patches').val();}
$.ajax({url:widget_baseURL+'/overlay/load-checkout',type:"POST",data:{"product_id":product_id,"personalisation":personalisation,"billing_country_id":$bill.val(),"delivery_country_id":$deli.val(),"own_name":$own_name,"own_number":$own_number,"patches":$patches,"identify":identify,"http_host":host},beforeSend:function(){$product_container.find(".ilt_product.ilt_active").addClass("ilt_loading");},complete:function(){$product_container.find(".ilt_product.ilt_active").removeClass("ilt_loading");},success:function(result){result=JSON.parse(result);$product_container.find('.ilt-shopping-cart-count').text('1');$c_product.find('.ilt_checkout_product_row > div:not(.ilt_load_checkout)').css({display:''});$c_product.find('.ilt_checkout_product_price').attr('data-price',result.product_price);$c_product.find('.ilt_checkout_product_price').html(result.product_price_formatted);var personalisation_name='';if(result.personalisation_name!==null){personalisation_name=messages.player+': '+result.personalisation_name;}
$c_product.find('.ilt_checkout_product_personalisation_name').html(personalisation_name);$c_product.find('.ilt_checkout_product_patches').html(result.patches_name);$c_product.find('.ilt_load_checkout').addClass('ilt_checkout_loaded').html(result.html);if(enable_apple_pay){$c_product.find('.ilt_hide_apple_pay').show();$c_product.find('.ilt_hide_apple_pay_later').show();$c_product.find('.ilt_apple_pay_confirm_info, .ilt_apple_pay_confirm_btn').hide();window.parent.postMessage({'apple_pay_checkout':true,'iframeId':$iframeId,'result':result},"*");}else{console.log('apple_pay disabled');}}});}
function PersonalisationUpdate()
{var $c_product=$product_container.find(".ilt_product.ilt_active");var ilt_product_orginal_price=$product_container.find(".ilt_product.ilt_active .ilt_product_orginal_price");var ilt_product_price=$product_container.find(".ilt_product.ilt_active .ilt_product_price");var product_id=$c_product.attr('data-product');var personalisationName=$c_product.find('.ilt_product_personalisation').val();var $patches=null;if(personalisationName!=''){$patches=$c_product.find('.ilt_product_patches').val();$c_product.find('.ilt_patches').show();}
else{$c_product.find('.ilt_product_patches').val('');$c_product.find('.ilt_patches').hide();}
var player_image=$c_product.find('.ilt_product_personalisation').find(':selected').attr('data-image');if(player_image){var product_name=$c_product.find('.ilt_product_details .ilt_product_title_desktop').html();if(product_name.toLowerCase().includes("training")){player_image=trainingImageUrl(player_image);}
var $main_img=$c_product.find(".ilt_checkout_show_desktop .ilt_product_image_wrapper img");var $mobile_active_img=$c_product.find(".ilt_checkout_hide_desktop .ilt_product_image_wrapper").attr("data-img");var $mobile_img=$c_product.find(".ilt_checkout_hide_desktop .ilt_product_image_wrapper_single[data-img="+$mobile_active_img+"] img");$main_img.attr('src',player_image);$mobile_img.attr('src',player_image);}
var $is_shipping_different=$c_product.find('.ilt_checkout_form_delivery').hasClass('ilt_checkout_form_delivery_active');var $bill=$c_product.find('.ilt_checkout_country_billing');var $deli=$c_product.find('.ilt_checkout_country_delivery');if(!$is_shipping_different){$deli.val($bill.val());}
if(personalisationName=='OWN_NAME_NUMBER'){var $own_name=$c_product.find(".ilt_own_name_input").val();var $own_number=$c_product.find(".ilt_own_number_input").val();$c_product.find('.ilt_own_name_number').show();if(!$c_product.find('.ilt_product_personalisation').hasClass('ilt_personalisation_shirt')){$c_product.find(".ilt_own_name_input").hide();$c_product.find(".ilt_own_number_input").css('width','100%').attr('placeholder','ENTER NUMBER');}
else{$c_product.find(".ilt_own_name_input").show();$c_product.find(".ilt_own_number_input").css('width','20%').attr('placeholder','NO.');}}
else{var $own_name=null;var $own_number=null;$c_product.find('.ilt_own_name_number').hide();scrollToProductImages();}
$.ajax({url:widget_baseURL+'/overlay/set-personalisation',data:{product_id:product_id,personalisation:personalisationName,billing_country_id:$bill.val(),delivery_country_id:$deli.val(),own_name:$own_name,own_number:$own_number,patches:$patches},success:function(result){$c_product.find('input[name="Cart[personalisation]"]').val(personalisationName);$c_product.find('input[name="Cart[patches]"]').val($patches);ilt_product_orginal_price.html('was '+result.orginal_price_formatted);ilt_product_price.html(result.price_formatted);var show_gift=false;var curr=$c_product.find('.ilt_product_price').attr('data-currency').toLowerCase();switch(curr){case 'gbp':if(result.price>=40)show_gift=true;break;case 'aud':if(result.price>=75)show_gift=true;break;case 'eur':if(result.price>=50)show_gift=true;break;case 'usd':if(result.price>=60)show_gift=true;break;}
$c_product.find('.ilt_product_free_gift_voucher').toggle(show_gift);},});}
function ownPlayerName()
{var $c_product=$product_container.find(".ilt_product.ilt_active");var personalisationName=$c_product.find('.ilt_product_personalisation').val();if(personalisationName!=='OWN_NAME_NUMBER'){return;}
var image_url=getPersonalisationImageUrl();var $own_name=$c_product.find(".ilt_own_name_input").val();var $own_number=$c_product.find(".ilt_own_number_input").val();var $main_img=$c_product.find(".ilt_checkout_show_desktop .ilt_product_image_wrapper img");var $mobile_active_img=$c_product.find(".ilt_checkout_hide_desktop .ilt_product_image_wrapper").attr("data-img");var $mobile_img=$c_product.find(".ilt_checkout_hide_desktop .ilt_product_image_wrapper_single[data-img="+$mobile_active_img+"] img");if(($c_product.find('.ilt_product_personalisation').hasClass('ilt_personalisation_shirt')&&($own_name===''||$own_number===''))||(!$c_product.find('.ilt_product_personalisation').hasClass('ilt_personalisation_shirt')&&$own_number==='')){$c_product.find(".ilt_checkout_show_desktop .ilt_product_image_wrapper").removeAttr('data-personalisation');return;}
$c_product.find(".ilt_checkout_show_desktop .ilt_product_image_wrapper").attr('data-personalisation',true);image_url=ownImageUrl(image_url,$own_name.toUpperCase(),$own_number);$main_img.attr('src',image_url);$mobile_img.attr('src',image_url);scrollToProductImages();}
function scrollToProductImages()
{if(window.innerWidth<990){var $c_product=$product_container.find(".ilt_product.ilt_active");$c_product.find('.ilt_product_wrapper').animate({scrollTop:$c_product.find('.ilt_main_page .ilt_checkout_hide_desktop .ilt_product_image_wrapper').scrollTop()+100},1000);}}
function setPatchesImage()
{var $c_product=$product_container.find(".ilt_product.ilt_active");var product_name=$c_product.find('.ilt_product_details .ilt_product_title_desktop').html();if(product_name.toLowerCase().includes("training")){return;}
var $default_img=$c_product.find(".ilt_checkout_show_desktop .ilt_product_image_wrapper_side:first img").attr('src');var lastslashindex=$default_img.lastIndexOf('/');var ID=$default_img.substring(lastslashindex+1).replace("_f","").toUpperCase();var image_url=getPersonalisationImageUrl();var $main_img=$c_product.find(".ilt_checkout_show_desktop .ilt_product_image_wrapper img");var $mobile_active_img=$c_product.find(".ilt_checkout_hide_desktop .ilt_product_image_wrapper").attr("data-img");var $mobile_img=$c_product.find(".ilt_checkout_hide_desktop .ilt_product_image_wrapper_single[data-img="+$mobile_active_img+"] img");switch($c_product.find('.ilt_product_patches').val()){case 'premier_patches':image_url=setUrlParam(image_url,'patches','patches_'+ID+'-pl');break;case 'europa_patches':image_url=setUrlParam(image_url,'patches','patches_'+ID+'-el');break;default:image_url=setUrlParam(image_url,'patches','patchesnone');}
$c_product.find(".ilt_checkout_show_desktop .ilt_product_image_wrapper").attr('data-personalisation',true);$main_img.attr('src',image_url);$mobile_img.attr('src',image_url);}
function trainingImageUrl(url)
{if(url.indexOf("numbers=")>=0)
{var number_suffix=url.substring(url.indexOf('numbers'));number_suffix=number_suffix.substring(number_suffix.indexOf("=")+1);number_suffix=(number_suffix.indexOf("&")>=0)?number_suffix.substring(number_suffix.indexOf("&")):"";var player_number=url.substring(url.lastIndexOf("--")+2,url.lastIndexOf("&"));url=url.replace('pl','arsenal');url=url.split("?")[0];url+='?name='+player_number;url+=number_suffix;}
return url;}
function ownImageUrl(url,name,number,patches)
{url=setUrlParam(url,'name',name);if(number&&url.indexOf("numbers=")>=0)
{var number_prefix=url.substring(0,url.indexOf('numbers'));var number_suffix=url.substring(url.indexOf('numbers'));number_suffix=number_suffix.substring(number_suffix.indexOf("=")+1);var numbers_param=number_suffix.substr(0,number_suffix.indexOf('--'));number_suffix=(number_suffix.indexOf("&")>=0)?number_suffix.substring(number_suffix.indexOf("&")):"";if(numbers_param){number=numbers_param+'--'+number;}
url=number_prefix+"numbers="+number+number_suffix;}
return url;}
var amazonReferenceCreated=false;var amazonReferenceUpdated=false;function amazonPayInitWidgets(response)
{if(typeof response.access_token==='undefined'){return false;}
if(typeof amazon_pay.merchant_id==='undefined'){return false;}
amazon_pay.access_token=response.access_token;var $c_product=$product_container.find(".ilt_product.ilt_active");$c_product.find('.ilt_checkout_table_delivery').html('');window.onAmazonPaymentsReady=function(){new OffAmazonPayments.Widgets.AddressBook({sellerId:amazon_pay.merchant_id,onOrderReferenceCreate:function(orderReference){createOrderReferenceDetails(orderReference.getAmazonOrderReferenceId());},onAddressSelect:function(){if(amazonReferenceCreated){updateDeliveryBox();}},design:{designMode:'responsive'},onError:function(error){}}).bind("addressBookWidgetDiv");new OffAmazonPayments.Widgets.Wallet({sellerId:amazon_pay.merchant_id,onPaymentSelect:function(orderReference){},design:{designMode:'responsive'},onError:function(error){if(error.getErrorCode()!==''){$c_product.find('.ilt_load_checkout').html('<div class="payment-errors">'+error.getErrorMessage()+'</div>');}}}).bind("walletWidgetDiv");};$c_product.find('.ilt_checkout_amazon_pay_widgets').show();$c_product.find('.amazon-pay-response').show();$c_product.find('.ilt_hide_apple_pay').hide();var script=$('<script>',{type:'text/javascript',src:amazon_pay.widget_url});script[0].setAttribute("async","");$body.before(script);}
function createOrderReferenceDetails(amazonOrderReferenceId)
{if(!enable_amazon_pay||typeof amazon_pay.access_token==='undefined'){return false;}
var $c_product=$product_container.find(".ilt_product.ilt_active");var amount=$c_product.find(".ilt_checkout_product_price").attr("data-price");$.ajax({url:widget_baseURL+'/checkout/create-details',type:"POST",data:{orderReferenceId:amazonOrderReferenceId,accessToken:amazon_pay.access_token,amount:amount,},success:function(response){if(response.ok){amazonReferenceCreated=true;updateDeliveryBox();}
$c_product.find('.ilt_checkout_submit_button.ilt_checkout_show_cart').show();},error:function(){}});}
function updateOrderReferenceDetails()
{if(!enable_amazon_pay||typeof amazon_pay.access_token==='undefined'){return false;}
amazonReferenceUpdated=false;var $c_product=$product_container.find(".ilt_product.ilt_active");var amount=$c_product.find(".ilt_checkout_table .ilt_checkout_total_price").attr("data-price");var currency=$c_product.find(".ilt_checkout_table .ilt_checkout_total_price").attr("data-currency-iso");if(typeof amount==='undefined'){amount=$c_product.find(".ilt_checkout_product_price").attr("data-price");}
$.ajax({url:widget_baseURL+'/checkout/update-details',type:"POST",data:{accessToken:amazon_pay.access_token,amount:amount,currency:currency,},success:function(response){if(response.ok){amazonReferenceUpdated=true;}}});}
if(window.addEventListener)
window.addEventListener("message",onOverlayMessage,false);else if(window.attachEvent)
window.attachEvent("onmessage",onOverlayMessage,false);function addViewCount(action,product_id)
{}
function onOverlayMessage(event)
{if(typeof event.data!=='object'||typeof event.data.iframeId==='undefined'){return;}
if(typeof $iframeId==='undefined'&&event.data.iframeId.indexOf(identify)<=0){return;}
if(typeof $main_container==='undefined'){$main_container=$('body');}
var $iframe=$main_container.find('iframe#'+event.data.iframeId);if($iframe.length===0){return;}
if(event.data.apple_pay_checkout){var result=event.data.result;console.log('apple_pay_checkout 2');if(window.ApplePaySession&&result){console.log('apple_pay_init 1');Stripe.setPublishableKey(result.apple_pay.stripe_public_key);Stripe.applePay.stripeAccount=result.apple_pay.stripe_account_id;Stripe.applePay.checkAvailability(function(available){if(available){console.log('apple_pay_init 2');$iframe[0].contentWindow.postMessage({'apple_pay_init':true,'result':result,'iframeId':event.data.iframeId},"*");}});}}else if(event.data.apple_pay_request){console.log('apple_pay_request 2');var paymentRequest=event.data.paymentRequest;if(window.ApplePaySession&&paymentRequest){console.log('apple_pay_request 3');var session=Stripe.applePay.buildSession(paymentRequest,function(res,completion){completion(ApplePaySession.STATUS_SUCCESS);console.log('apple_pay_request success');console.log(res);$iframe[0].contentWindow.postMessage({'apple_pay_response':true,'success':true,'cancel':false,'res':res},"*");},function(error){console.log('An error: '+error.message);$iframe[0].contentWindow.postMessage({'apple_pay_response':true,'success':false,'cancel':false},"*");});session.oncancel=function(){console.log('apple_pay_request cancel');$iframe[0].contentWindow.postMessage({'apple_pay_response':true,'success':false,'cancel':true},"*");};session.begin();}}}
function tap(el,delay)
{if(window.innerWidth<=450){el.addClass('ilt-tapped');if(typeof delay==='undefined')delay=50;setTimeout(function(){el.removeClass('ilt-tapped');},delay);}}
function setUrlParam(url,paramName,paramValue)
{if(url.indexOf(paramName+"=")>=0)
{var prefix=url.substring(0,url.indexOf(paramName));var suffix=url.substring(url.indexOf(paramName));suffix=suffix.substring(suffix.indexOf("=")+1);suffix=(suffix.indexOf("&")>=0)?suffix.substring(suffix.indexOf("&")):"";url=prefix+paramName+"="+paramValue+suffix;}
else
{if(url.indexOf("?")<0)
url+="?"+paramName+"="+paramValue;else
url+="&"+paramName+"="+paramValue;}
return url;}
function getQueryParam(name,url)
{if(!url)url=window.location.href;name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(url);return results==null?null:results[1];}
function getLocation(href)
{var l=document.createElement("a");l.href=href;return l;}
function setCookie(key,value,expiry)
{if(typeof expiry==='undefined')expiry=1;var expires=new Date();expires.setTime(expires.getTime()+(expiry*60*60*1000));document.cookie=key+'='+value+';path=/'+';expires='+expires.toUTCString();}
function getCookie(key)
{var keyValue=document.cookie.match('(^|;) ?'+key+'=([^;]*)(;|$)');return keyValue?keyValue[2]:null;}
String.prototype.includes=function(str){var returnValue=false;if(this.indexOf(str)!==-1){returnValue=true;}
return returnValue;}
Array.prototype.contains=function(obj){var i=this.length;while(i--){if(this[i]==obj){return true;}}
return false;}
function b(a){void 0===a&&(a=window.navigator.userAgent),a=a.toLowerCase();var b=/(edge)\/([\w.]+)/.exec(a)||/(opr)[\/]([\w.]+)/.exec(a)||/(chrome)[ \/]([\w.]+)/.exec(a)||/(iemobile)[\/]([\w.]+)/.exec(a)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[],c=/(ipad)/.exec(a)||/(ipod)/.exec(a)||/(windows phone)/.exec(a)||/(iphone)/.exec(a)||/(kindle)/.exec(a)||/(silk)/.exec(a)||/(android)/.exec(a)||/(win)/.exec(a)||/(mac)/.exec(a)||/(linux)/.exec(a)||/(cros)/.exec(a)||/(playbook)/.exec(a)||/(bb)/.exec(a)||/(blackberry)/.exec(a)||[],d={},e={browser:b[5]||b[3]||b[1]||"",version:b[2]||b[4]||"0",versionNumber:b[4]||b[2]||"0",platform:c[0]||""};if(e.browser&&(d[e.browser]=!0,d.version=e.version,d.versionNumber=parseInt(e.versionNumber,10)),e.platform&&(d[e.platform]=!0),(d.android||d.bb||d.blackberry||d.ipad||d.iphone||d.ipod||d.kindle||d.playbook||d.silk||d["windows phone"])&&(d.mobile=!0),(d.cros||d.mac||d.linux||d.win)&&(d.desktop=!0),(d.chrome||d.opr||d.safari)&&(d.webkit=!0),d.rv||d.iemobile){var f="msie";e.browser=f,d[f]=!0}if(d.edge){delete d.edge;var g="msedge";e.browser=g,d[g]=!0}if(d.safari&&d.blackberry){var h="blackberry";e.browser=h,d[h]=!0}if(d.safari&&d.playbook){var i="playbook";e.browser=i,d[i]=!0}if(d.bb){var j="blackberry";e.browser=j,d[j]=!0}if(d.opr){var k="opera";e.browser=k,d[k]=!0}if(d.safari&&d.android){var l="android";e.browser=l,d[l]=!0}if(d.safari&&d.kindle){var m="kindle";e.browser=m,d[m]=!0}if(d.safari&&d.silk){var n="silk";e.browser=n,d[n]=!0}return d.name=e.browser,d.platform=e.platform,d}